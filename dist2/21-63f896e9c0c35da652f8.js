(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{FLGI:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=g(n("pRfh")),r=g(n("KN1l")),i=g(n("6F6v")),o=g(n("clYf")),s=g(n("G+8T")),l=g(n("p02J")),u=g(n("cLmd")),c=g(n("dAt5")),d=g(n("Fo7F")),m=g(n("cDcd")),f=g(n("+0q/")),p=g(n("VNe4")),A=g(n("3V/B"));function g(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){return function(t){function n(){var e,t,u,d,m,g=this;(0,l.default)(this,n);for(var _=arguments.length,h=Array(_),v=0;v<_;v++)h[v]=arguments[v];return t=u=(0,c.default)(this,(e=n.__proto__||(0,s.default)(n)).call.apply(e,[this].concat(h))),u.state={loadState:{loading:!1,error:!1,errorMsg:"",isOk:!1}},u.getData=(m=(0,o.default)(a.default.mark(function e(){var t,n,o,s,l,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments[1],m=c.url,_=c.delaytime,h=void 0===_?0:_,v=c.cachetime,C=void 0===v?C:v,E=(0,i.default)(c,["url","delaytime","cachetime"]);return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!u.loading){e.next=2;break}return e.abrupt("return");case 2:return u.loading=!0,u.delayStart=Date.now(),u.setState({loadState:{loading:!0,error:!1,errorMsg:"",isOk:!1}}),t=m+f.default.stringify(E.params),n=void 0,e.next=9,db.req.where("req").equalsIgnoreCase(t).last();case 9:if(!(o=e.sent)){e.next=20;break}if(n=o.res,!(s=o.time)||!(Date.now()-s>C)&&n.success){e.next=18;break}return e.next=16,(0,p.default)((0,r.default)({url:m},E));case 16:n=e.sent,db.req.put({req:t,res:n,time:Date.now()});case 18:e.next=24;break;case 20:return e.next=22,(0,p.default)((0,r.default)({url:m},E));case 22:n=e.sent,db.req.put({req:t,res:n,time:Date.now()});case 24:if(!((l=u.delayStart+h-Date.now())>0)){e.next=28;break}return e.next=28,(0,A.default)(l);case 28:if(!n.success){e.next=35;break}if(!d){e.next=32;break}return e.next=32,d(n.data);case 32:u.setState({loadState:{loading:!1,error:!1,errorMsg:"",isOk:!0}}),e.next=36;break;case 35:u.setState({loadState:{loading:!1,error:!0,errorMsg:n.message,isOk:!1}});case 36:u.loading=!1;case 37:case"end":return e.stop()}},e,g)})),function(){return m.apply(this,arguments)}),d=t,(0,c.default)(u,d)}return(0,d.default)(n,t),(0,u.default)(n,[{key:"render",value:function(){return m.default.createElement(e,(0,r.default)({},this.props,this.state,{getData:this.getData}))}}]),n}(m.default.Component)}},GZ4P:function(e,t,n){var a=n("Xf7A");"string"==typeof a&&(a=[[e.i,a,""]]);n("DkTI")(a,{hmr:!0,transform:void 0,insertInto:void 0}),a.locals&&(e.exports=a.locals)},VNe4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n("heMk")),r=i(n("KN1l"));function i(e){return e&&e.__esModule?e:{default:e}}var o=i(n("zr5I")).default.create({baseURL:AppConfig.doubanUrl,timeout:5e3,dataType:"json"});o.interceptors.response.use(function(e){return{success:!0,data:e.data}},function(e){var t,n={};if(e.response){var i=e.response,o="object"!=(void 0===(t=i.data)?"undefined":(0,a.default)(t))||"[object object]"!=Object.prototype.toString.call(t).toLowerCase()||t.length?{}:i.data;n=(0,r.default)({message:o.message||o.msg||i.statusText,status:i.status},o)}else e.request?n.message="网络错误，请检查你的网络状态":console.log("Error",e.message);return 401==n.status&&(localStorage.removeItem("authorization"),store.dispatch("user/init",{})),n.success=!1,console.log(n),n}),t.default=o},Xf7A:function(e,t,n){(t=e.exports=n("3G5m")(!0)).push([e.i,".List_listitem_q_SyT {\n  display: flex;\n  margin: 0;\n  padding: 0.08rem 0.15rem;\n  background: #fff;\n  color: #000;\n  border-bottom: 1px solid #f4f4f4; }\n  .List_listitem_q_SyT .List_img_1qW7B {\n    width: 0.8rem;\n    height: 1.1rem;\n    background-size: cover;\n    background-position: center;\n    margin: 0 0.1rem 0 0; }\n  .List_listitem_q_SyT .List_detail_1ts-7 {\n    flex: 1; }\n  .List_listitem_q_SyT .List_title_3RhHk {\n    font-size: 0.17rem;\n    line-height: 0.22rem;\n    height: auto; }\n  .List_listitem_q_SyT .List_detail_1ts-7 {\n    margin: 0.05rem 0; }\n  .List_listitem_q_SyT .List_info_20Nl0 {\n    display: block;\n    color: #999;\n    font-size: 0.13rem;\n    line-height: 0.22rem;\n    margin: 0.05rem 0 0; }\n  .List_listitem_q_SyT .List_img_1qW7B + .List_detail_1ts-7 {\n    margin: 0; }\n    .List_listitem_q_SyT .List_img_1qW7B + .List_detail_1ts-7 .List_title_3RhHk {\n      max-height: 0.44rem;\n      overflow: hidden; }\n    .List_listitem_q_SyT .List_img_1qW7B + .List_detail_1ts-7 .List_info_20Nl0 {\n      margin: 0; }\n\n.List_nodata_1zLS_ {\n  padding: 0.15rem 0;\n  text-align: center;\n  color: #666;\n  font-size: 0.15rem; }\n","",{version:3,sources:["E:/www/webpack4/src/pages/Movies/Components/List.scss"],names:[],mappings:"AAAA;EACE,cAAc;EACd,UAAU;EACV,yBAAyB;EACzB,iBAAiB;EACjB,YAAY;EACZ,iCAAiC,EAAE;EACnC;IACE,cAAc;IACd,eAAe;IACf,uBAAuB;IACvB,4BAA4B;IAC5B,qBAAqB,EAAE;EACzB;IACE,QAAQ,EAAE;EACZ;IACE,mBAAmB;IACnB,qBAAqB;IACrB,aAAa,EAAE;EACjB;IACE,kBAAkB,EAAE;EACtB;IACE,eAAe;IACf,YAAY;IACZ,mBAAmB;IACnB,qBAAqB;IACrB,oBAAoB,EAAE;EACxB;IACE,UAAU,EAAE;IACZ;MACE,oBAAoB;MACpB,iBAAiB,EAAE;IACrB;MACE,UAAU,EAAE;;AAElB;EACE,mBAAmB;EACnB,mBAAmB;EACnB,YAAY;EACZ,mBAAmB,EAAE",file:"List.scss",sourcesContent:[".listitem {\n  display: flex;\n  margin: 0;\n  padding: 0.08rem 0.15rem;\n  background: #fff;\n  color: #000;\n  border-bottom: 1px solid #f4f4f4; }\n  .listitem .img {\n    width: 0.8rem;\n    height: 1.1rem;\n    background-size: cover;\n    background-position: center;\n    margin: 0 0.1rem 0 0; }\n  .listitem .detail {\n    flex: 1; }\n  .listitem .title {\n    font-size: 0.17rem;\n    line-height: 0.22rem;\n    height: auto; }\n  .listitem .detail {\n    margin: 0.05rem 0; }\n  .listitem .info {\n    display: block;\n    color: #999;\n    font-size: 0.13rem;\n    line-height: 0.22rem;\n    margin: 0.05rem 0 0; }\n  .listitem .img + .detail {\n    margin: 0; }\n    .listitem .img + .detail .title {\n      max-height: 0.44rem;\n      overflow: hidden; }\n    .listitem .img + .detail .info {\n      margin: 0; }\n\n.nodata {\n  padding: 0.15rem 0;\n  text-align: center;\n  color: #666;\n  font-size: 0.15rem; }\n"],sourceRoot:""}]),t.locals={listitem:"List_listitem_q_SyT",img:"List_img_1qW7B",detail:"List_detail_1ts-7",title:"List_title_3RhHk",info:"List_info_20Nl0",nodata:"List_nodata_1zLS_"}},m1eu:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,r=p(n("2V83")),i=p(n("KN1l")),o=p(n("G+8T")),s=p(n("p02J")),l=p(n("cLmd")),u=p(n("dAt5")),c=p(n("Fo7F"));n("cmGT");var d=n("cDcd"),m=p(d),f=p(n("vLOP"));function p(e){return e&&e.__esModule?e:{default:e}}var A=(0,n("rRcN").contextConsumers)(function(e){return{movieSelectKey:e.movieSelectKey,movies:e.movies}})(a=function(e){function t(){var e,n,a,r;(0,s.default)(this,t);for(var i=arguments.length,l=Array(i),c=0;c<i;c++)l[c]=arguments[c];return n=a=(0,u.default)(this,(e=t.__proto__||(0,o.default)(t)).call.apply(e,[this].concat(l))),a.renderContent=function(e){var t=a.props.match;return m.default.createElement(f.default,{tab:e,match:t})},a.handleTabClick=function(e){var t=a.props,n=t.movies,r=t.movieSelectKey;if(console.log("tab",e),r==e.key){var i=n[e.key];i=i.merge({scrollTop:0,scrollTopChange:!0}),a.props.dispatch.setIn(["movies",e.key],i)}else a.props.dispatch.set({movieSelectKey:e.key})},r=n,(0,u.default)(a,r)}return(0,c.default)(t,e),(0,l.default)(t,[{key:"render",value:function(){var e=this.props,t=e.movieSelectKey;return e.movies,m.default.createElement(r.default,{tabs:[{title:"正在上映",key:"movie/in_theaters"},{title:"即将上映",key:"movie/coming_soon"},{title:"Top250",key:"movie/top250"},{title:"北美票房榜",key:"movie/us_box"}],page:t,onTabClick:this.handleTabClick,renderTabBar:function(e){return m.default.createElement(r.default.DefaultTabBar,(0,i.default)({},e,{page:4}))}},this.renderContent)}}]),t}(d.Component))||a;t.default=A},vLOP:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,r,i,o=y(n("KN1l")),s=y(n("pRfh")),l=y(n("clYf")),u=y(n("G+8T")),c=y(n("p02J")),d=y(n("cLmd")),m=y(n("dAt5")),f=y(n("Fo7F")),p=n("cDcd"),A=y(p),g=n("8LOv"),_=(y(n("ntpP")),y(n("sgKC"))),h=y(n("kqMm")),v=y(n("GZ4P")),C=n("rRcN"),E=y(n("FLGI"));function y(e){return e&&e.__esModule?e:{default:e}}var k=(0,C.contextConsumers)(function(e,t){return{movie:e.getIn(["movies",t.tab.key])}})(a=(0,E.default)((i=r=function(e){function t(){var e,n,a,r,i=this;(0,c.default)(this,t);for(var o=arguments.length,d=Array(o),f=0;f<o;f++)d[f]=arguments[f];return n=a=(0,m.default)(this,(e=t.__proto__||(0,u.default)(t)).call.apply(e,[this].concat(d))),a.getData=(0,l.default)(s.default.mark(function e(){var t,n,r,o,u,c,d;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.props,n=t.tab,r=t.dispatch,o=t.movie,(u=o).data,c=u.start,d=u.count,u.more){e.next=4;break}return e.abrupt("return");case 4:a.props.getData({url:n.key,params:{start:c,count:d,city:"恩施"}},function(){var e=(0,l.default)(s.default.mark(function e(t){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=o.merge({total:t.total,more:!(t.subjects.length<d),start:c+d,isInit:!1,data:o.data.concat(t.subjects)}),r.setIn(["movies",n.key],o);case 2:case"end":return e.stop()}},e,i)}));return function(t){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}},e,i)})),a.handleScroll=function(e){a.setScrollTop(e),a.props.movie.more&&(a.props.loadState.error||a.load.getBoundingClientRect().top<window.screen.height+100&&a.getData())},a.setScrollTop=function(e){var t=a.props.tab;clearTimeout(a.delay),a.delay=setTimeout(function(){a.props.dispatch.setIn(["movies",t.key,"scrollTop"],e.scrollTop)},300)},a.scrollTopChangeBack=function(){var e=a.props,t=e.dispatch,n=e.tab,r=e.movie;r=r.merge({scrollTopChange:!1}),t.setIn(["movies",n.key],r)},r=n,(0,m.default)(a,r)}return(0,f.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){this.props.movie.isInit&&this.getData()}},{key:"render",value:function(){var e=this,t=this.props,n=(t.match,t.loadState),a=t.movie,r=a.data,i=(a.isInit,a.more),s=a.scrollTop,l=a.scrollTopChange;return A.default.createElement(_.default,{onScroll:this.handleScroll,scrollTop:s,scrollTopChange:l,scrollTopChangeBack:this.scrollTopChangeBack},r.map(function(e){return A.default.createElement(g.Link,{to:"/movies/"+e.id,key:e.id,className:v.default.listitem},A.default.createElement("div",{className:v.default.img,style:{backgroundImage:"url("+e.images.small+")"}}),A.default.createElement("div",{className:v.default.detail},A.default.createElement("div",{className:v.default.title},e.title),A.default.createElement("div",{className:v.default.info},A.default.createElement("div",null,"导演：",e.directors.map(function(e){return e.name+"，"})),A.default.createElement("div",null,"类型：",e.genres.map(function(e){return e+"，"})),A.default.createElement("div",null,"评分：",e.rating.average))))}),A.default.createElement("div",{ref:function(t){return e.load=t}}),A.default.createElement(h.default,(0,o.default)({},n,{loadingTitle:"数据加载中",errorAction:A.default.createElement("div",{onClick:this.getData},n.errorMsg,"，点击重试！")}),!i&&A.default.createElement("div",{className:v.default.nodata},"没有更多数据了")))}}]),t}(p.Component),r.defaultProps={movie:Immutable({data:[],total:0,start:0,count:20,more:!0,isInit:!0,scrollTop:0,scrollTopChange:!1})},a=i))||a)||a;t.default=k}}]);
//# sourceMappingURL=21-63f896e9c0c35da652f8.js.map