(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{"+XMT":function(e,t,n){var a,r;void 0===(r="function"==typeof(a=function(e,t){"use strict";var n=5e3,a="callback";function r(e){try{delete window[e]}catch(t){window[e]=void 0}}function i(e){var t=document.getElementById(e);t&&document.getElementsByTagName("head")[0].removeChild(t)}t.exports=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=e,l=t.timeout||n,s=t.jsonpCallback||a,u=void 0;return new Promise(function(n,a){var c=t.jsonpCallbackFunction||"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random()),d=s+"_"+c;window[c]=function(e){n({ok:!0,json:function(){return Promise.resolve(e)}}),u&&clearTimeout(u),i(d),r(c)},o+=-1===o.indexOf("?")?"?":"&";var f=document.createElement("script");f.setAttribute("src",""+o+s+"="+c),t.charset&&f.setAttribute("charset",t.charset),f.id=d,document.getElementsByTagName("head")[0].appendChild(f),u=setTimeout(function(){a(new Error("JSONP request to "+e+" timed out")),r(c),i(d),window[c]=function(){r(c)}},l),f.onerror=function(){a(new Error("JSONP request to "+e+" failed")),r(c),i(d),u&&clearTimeout(u)}})}})?a.apply(t,[t,e]):a)||(e.exports=r)},FLGI:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=h(n("KN1l")),r=h(n("pRfh")),i=h(n("6F6v")),o=h(n("clYf")),l=h(n("G+8T")),s=h(n("p02J")),u=h(n("cLmd")),c=h(n("dAt5")),d=h(n("Fo7F")),f=h(n("cDcd")),m=h(n("+0q/")),p=h(n("3V/B")),A=h(n("dlyW"));function h(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){return function(t){function n(){var e,t,a,u,d,f,h=this;(0,s.default)(this,n);for(var g=arguments.length,v=Array(g),_=0;_<g;_++)v[_]=arguments[_];return t=a=(0,c.default)(this,(e=n.__proto__||(0,l.default)(n)).call.apply(e,[this].concat(v))),a.state={loadState:{loading:!1,error:!1,errorMsg:"",isOk:!1}},a.getData=(f=(0,o.default)(r.default.mark(function e(){var t,n,o,l,s,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments[1],d=u.url,f=u.delaytime,A=void 0===f?0:f,g=u.cachetime,v=void 0===g?v:g,_=(0,i.default)(u,["url","delaytime","cachetime"]);return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.loading){e.next=2;break}return e.abrupt("return");case 2:return a.loading=!0,a.delayStart=Date.now(),t="https://api.douban.com/v2/"+d+"?"+m.default.stringify(_.params),n=void 0,e.next=8,db.req.where("req").equalsIgnoreCase(t).last();case 8:if(!(o=e.sent)){e.next=18;break}if(n=o.res,!(l=o.time)||!(Date.now()-l>v)&&n.success){e.next=16;break}return e.next=15,a.fetchData(t);case 15:n=e.sent;case 16:e.next=21;break;case 18:return e.next=20,a.fetchData(t);case 20:n=e.sent;case 21:if(!((s=a.delayStart+A-Date.now())>0)){e.next=25;break}return e.next=25,(0,p.default)(s);case 25:if(!n.success){e.next=32;break}if(!c){e.next=29;break}return e.next=29,c(n.data);case 29:a.setState({loadState:{loading:!1,error:!1,errorMsg:"",isOk:!0}}),e.next=33;break;case 32:a.setState({loadState:{loading:!1,error:!0,errorMsg:n.message,isOk:!1}});case 33:a.loading=!1;case 34:case"end":return e.stop()}},e,h)})),function(){return f.apply(this,arguments)}),a.fetchData=(d=(0,o.default)(r.default.mark(function e(t){var n;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({loadState:{loading:!0,error:!1,errorMsg:"",isOk:!1}}),e.next=3,(0,A.default)(t);case 3:return n=e.sent,db.req.put({req:t,res:n,time:Date.now()}),e.abrupt("return",n);case 6:case"end":return e.stop()}},e,h)})),function(e){return d.apply(this,arguments)}),u=t,(0,c.default)(a,u)}return(0,d.default)(n,t),(0,u.default)(n,[{key:"render",value:function(){return f.default.createElement(e,(0,a.default)({},this.props,this.state,{getData:this.getData}))}}]),n}(f.default.Component)}},GZ4P:function(e,t,n){var a=n("Xf7A");"string"==typeof a&&(a=[[e.i,a,""]]);n("DkTI")(a,{hmr:!0,transform:void 0,insertInto:void 0}),a.locals&&(e.exports=a.locals)},Xf7A:function(e,t,n){(t=e.exports=n("3G5m")(!0)).push([e.i,".List_listitem_q_SyT {\n  display: flex;\n  margin: 0;\n  padding: 0.08rem 0.15rem;\n  background: #fff;\n  color: #000;\n  border-bottom: 1px solid #f4f4f4; }\n  .List_listitem_q_SyT .List_img_1qW7B {\n    width: 0.8rem;\n    height: 1.1rem;\n    background-size: cover;\n    background-position: center;\n    margin: 0 0.1rem 0 0; }\n  .List_listitem_q_SyT .List_detail_1ts-7 {\n    flex: 1; }\n  .List_listitem_q_SyT .List_title_3RhHk {\n    font-size: 0.17rem;\n    line-height: 0.22rem;\n    height: auto; }\n  .List_listitem_q_SyT .List_detail_1ts-7 {\n    margin: 0.05rem 0; }\n  .List_listitem_q_SyT .List_info_20Nl0 {\n    display: block;\n    color: #999;\n    font-size: 0.13rem;\n    line-height: 0.22rem;\n    margin: 0.05rem 0 0; }\n  .List_listitem_q_SyT .List_img_1qW7B + .List_detail_1ts-7 {\n    margin: 0; }\n    .List_listitem_q_SyT .List_img_1qW7B + .List_detail_1ts-7 .List_title_3RhHk {\n      max-height: 0.44rem;\n      overflow: hidden; }\n    .List_listitem_q_SyT .List_img_1qW7B + .List_detail_1ts-7 .List_info_20Nl0 {\n      margin: 0; }\n\n.List_nodata_1zLS_ {\n  padding: 0.15rem 0;\n  text-align: center;\n  color: #666;\n  font-size: 0.15rem; }\n","",{version:3,sources:["E:/www/webpack4/src/pages/Movies/Components/List.scss"],names:[],mappings:"AAAA;EACE,cAAc;EACd,UAAU;EACV,yBAAyB;EACzB,iBAAiB;EACjB,YAAY;EACZ,iCAAiC,EAAE;EACnC;IACE,cAAc;IACd,eAAe;IACf,uBAAuB;IACvB,4BAA4B;IAC5B,qBAAqB,EAAE;EACzB;IACE,QAAQ,EAAE;EACZ;IACE,mBAAmB;IACnB,qBAAqB;IACrB,aAAa,EAAE;EACjB;IACE,kBAAkB,EAAE;EACtB;IACE,eAAe;IACf,YAAY;IACZ,mBAAmB;IACnB,qBAAqB;IACrB,oBAAoB,EAAE;EACxB;IACE,UAAU,EAAE;IACZ;MACE,oBAAoB;MACpB,iBAAiB,EAAE;IACrB;MACE,UAAU,EAAE;;AAElB;EACE,mBAAmB;EACnB,mBAAmB;EACnB,YAAY;EACZ,mBAAmB,EAAE",file:"List.scss",sourcesContent:[".listitem {\n  display: flex;\n  margin: 0;\n  padding: 0.08rem 0.15rem;\n  background: #fff;\n  color: #000;\n  border-bottom: 1px solid #f4f4f4; }\n  .listitem .img {\n    width: 0.8rem;\n    height: 1.1rem;\n    background-size: cover;\n    background-position: center;\n    margin: 0 0.1rem 0 0; }\n  .listitem .detail {\n    flex: 1; }\n  .listitem .title {\n    font-size: 0.17rem;\n    line-height: 0.22rem;\n    height: auto; }\n  .listitem .detail {\n    margin: 0.05rem 0; }\n  .listitem .info {\n    display: block;\n    color: #999;\n    font-size: 0.13rem;\n    line-height: 0.22rem;\n    margin: 0.05rem 0 0; }\n  .listitem .img + .detail {\n    margin: 0; }\n    .listitem .img + .detail .title {\n      max-height: 0.44rem;\n      overflow: hidden; }\n    .listitem .img + .detail .info {\n      margin: 0; }\n\n.nodata {\n  padding: 0.15rem 0;\n  text-align: center;\n  color: #666;\n  font-size: 0.15rem; }\n"],sourceRoot:""}]),t.locals={listitem:"List_listitem_q_SyT",img:"List_img_1qW7B",detail:"List_detail_1ts-7",title:"List_title_3RhHk",info:"List_info_20Nl0",nodata:"List_nodata_1zLS_"}},dlyW:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=l(n("pRfh")),r=l(n("18by")),i=l(n("clYf")),o=l(n("+XMT"));function l(e){return e&&e.__esModule?e:{default:e}}var s,u=(s=(0,i.default)(a.default.mark(function e(t){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new r.default(function(e,n){(0,o.default)(t).then(function(e){return e.json()}).then(function(t){e({success:!0,data:t})}).catch(function(t){e({success:!1,message:t.message})})}));case 1:case"end":return e.stop()}},e,void 0)})),function(e){return s.apply(this,arguments)});t.default=u},m1eu:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,r=p(n("2V83")),i=p(n("KN1l")),o=p(n("G+8T")),l=p(n("p02J")),s=p(n("cLmd")),u=p(n("dAt5")),c=p(n("Fo7F"));n("cmGT");var d=n("cDcd"),f=p(d),m=p(n("vLOP"));function p(e){return e&&e.__esModule?e:{default:e}}var A=(0,n("rRcN").contextConsumers)(function(e){return{movieSelectKey:e.movieSelectKey,movies:e.movies}})(a=function(e){function t(){var e,n,a,r;(0,l.default)(this,t);for(var i=arguments.length,s=Array(i),c=0;c<i;c++)s[c]=arguments[c];return n=a=(0,u.default)(this,(e=t.__proto__||(0,o.default)(t)).call.apply(e,[this].concat(s))),a.renderContent=function(e){var t=a.props.match;return f.default.createElement(m.default,{tab:e,match:t})},a.handleChange=function(e){a.props.dispatch.set({movieSelectKey:e.key})},r=n,(0,u.default)(a,r)}return(0,c.default)(t,e),(0,s.default)(t,[{key:"render",value:function(){var e=this.props,t=e.movieSelectKey;return e.movies,f.default.createElement(r.default,{tabs:[{title:"正在上映",key:"movie/in_theaters"},{title:"即将上映",key:"movie/coming_soon"},{title:"Top250",key:"movie/top250"},{title:"北美票房榜",key:"movie/us_box"}],page:t,onChange:this.handleChange,renderTabBar:function(e){return f.default.createElement(r.default.DefaultTabBar,(0,i.default)({},e,{page:4}))}},this.renderContent)}}]),t}(d.Component))||a;t.default=A},vLOP:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,r,i,o=C(n("KN1l")),l=C(n("pRfh")),s=C(n("clYf")),u=C(n("G+8T")),c=C(n("p02J")),d=C(n("cLmd")),f=C(n("dAt5")),m=C(n("Fo7F")),p=n("cDcd"),A=C(p),h=n("8LOv"),g=(C(n("ntpP")),C(n("sgKC"))),v=C(n("kqMm")),_=C(n("GZ4P")),E=n("rRcN"),y=C(n("FLGI"));function C(e){return e&&e.__esModule?e:{default:e}}var B=(0,E.contextConsumers)(function(e,t){return{movie:e.getIn(["movies",t.tab.key])}})(a=(0,y.default)((i=r=function(e){function t(){var e,n,a,r,i=this;(0,c.default)(this,t);for(var o=arguments.length,d=Array(o),m=0;m<o;m++)d[m]=arguments[m];return n=a=(0,f.default)(this,(e=t.__proto__||(0,u.default)(t)).call.apply(e,[this].concat(d))),a.getData=(0,s.default)(l.default.mark(function e(){var t,n,r,o,u,c,d;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.props,n=t.tab,r=t.dispatch,o=t.movie,(u=o).data,c=u.start,d=u.count,u.more){e.next=4;break}return e.abrupt("return");case 4:a.props.getData({url:n.key,params:{start:c,count:d,city:"恩施"}},function(){var e=(0,s.default)(l.default.mark(function e(t){return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=o.merge({total:t.total,more:!(t.subjects.length<d),start:c+d,isInit:!1,data:o.data.concat(t.subjects)}),r.setIn(["movies",n.key],o);case 2:case"end":return e.stop()}},e,i)}));return function(t){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}},e,i)})),a.handleScroll=function(e){a.setScrollTop(e),a.props.movie.more&&(a.props.loadState.error||a.load.getBoundingClientRect().top<window.screen.height+100&&a.getData())},a.setScrollTop=function(e){var t=a.props.tab;clearTimeout(a.delay),a.delay=setTimeout(function(){a.props.dispatch.setIn(["movies",t.key,"scrollTop"],e.scrollTop)},300)},a.scrollTopChangeBack=function(){var e=a.props,t=e.dispatch,n=e.tab,r=e.movie;r=r.merge({scrollTopChange:!1}),t.setIn(["movies",n.key],r)},r=n,(0,f.default)(a,r)}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){this.props.movie.isInit&&this.getData()}},{key:"render",value:function(){var e=this,t=this.props,n=(t.match,t.loadState),a=t.movie,r=a.data,i=(a.isInit,a.more),l=a.scrollTop,s=a.scrollTopChange;return A.default.createElement(g.default,{onScroll:this.handleScroll,scrollTop:l,scrollTopChange:s,scrollTopChangeBack:this.scrollTopChangeBack},r.map(function(e){return A.default.createElement(h.Link,{to:"/movies/"+e.id,key:e.id,className:_.default.listitem},A.default.createElement("div",{className:_.default.img,style:{backgroundImage:"url("+e.images.small+")"}}),A.default.createElement("div",{className:_.default.detail},A.default.createElement("div",{className:_.default.title},e.title),A.default.createElement("div",{className:_.default.info},A.default.createElement("div",null,"导演：",e.directors.map(function(e){return e.name+"，"})),A.default.createElement("div",null,"类型：",e.genres.map(function(e){return e+"，"})),A.default.createElement("div",null,"评分：",e.rating.average))))}),A.default.createElement("div",{ref:function(t){return e.load=t}}),A.default.createElement(v.default,(0,o.default)({},n,{loadingTitle:"数据加载中",errorAction:A.default.createElement("div",{onClick:this.getData},n.errorMsg,"，点击重试！")}),!i&&A.default.createElement("div",{className:_.default.nodata},"没有更多数据了")))}}]),t}(p.Component),r.defaultProps={movie:Immutable({data:[],total:0,start:0,count:20,more:!0,isInit:!0,scrollTop:0,scrollTopChange:!1})},a=i))||a)||a;t.default=B}}]);
//# sourceMappingURL=23-71bd343b5c93ee627490.js.map